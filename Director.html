<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Director - Administration</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="shared-styles.css">
    <link rel="stylesheet" href="animations.css">
    <link rel="stylesheet" href="navbar.css">
    <link rel="stylesheet" href="hod.css">
    <link rel="stylesheet" href="footer.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <style>
        /* ===== MODAL STYLES ===== */
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.55);
            z-index: 9999;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
        }
        .modal.active { display: flex; }

        .modal-content {
            background: #fff;
            border-radius: 16px;
            padding: 36px 32px 28px;
            width: 100%;
            max-width: 520px;
            position: relative;
            box-shadow: 0 20px 60px rgba(0,0,0,0.2);
            max-height: 90vh;
            overflow-y: auto;
            animation: modalIn .25s ease;
        }
        @keyframes modalIn {
            from { opacity:0; transform: translateY(-20px) scale(.97); }
            to   { opacity:1; transform: translateY(0) scale(1); }
        }
        .modal-content h2 {
            margin: 0 0 22px;
            font-size: 1.4rem;
            color: #1a237e;
            border-bottom: 2px solid #e8eaf6;
            padding-bottom: 12px;
        }
        .modal-close {
            position: absolute;
            top: 14px; right: 18px;
            font-size: 1.6rem;
            cursor: pointer;
            color: #888;
            background: none; border: none;
            line-height: 1;
            transition: color .2s;
        }
        .modal-close:hover { color: #c62828; }

        .modal-content label {
            display: block;
            font-size: .83rem;
            font-weight: 600;
            color: #555;
            margin: 14px 0 5px;
            text-transform: uppercase;
            letter-spacing: .5px;
        }
        .modal-content input,
        .modal-content textarea,
        .modal-content select {
            width: 100%;
            padding: 9px 13px;
            border: 1.5px solid #c5cae9;
            border-radius: 8px;
            font-size: .95rem;
            box-sizing: border-box;
            transition: border .2s;
            outline: none;
        }
        .modal-content input:focus,
        .modal-content textarea:focus,
        .modal-content select:focus { border-color: #3949ab; }
        .modal-content textarea { resize: vertical; min-height: 90px; }

        /* Photo upload area */
        .photo-upload-area {
            border: 2px dashed #c5cae9;
            border-radius: 12px;
            padding: 18px;
            text-align: center;
            cursor: pointer;
            transition: border-color .2s, background .2s;
            background: #f5f5ff;
            margin-bottom: 4px;
        }
        .photo-upload-area:hover { border-color: #3949ab; background: #ede7f6; }
        .photo-upload-area i { font-size: 2rem; color: #7986cb; margin-bottom: 8px; display: block; }
        .photo-upload-area p { margin: 0; font-size: .88rem; color: #666; }
        #photoPreview {
            width: 100px; height: 100px;
            border-radius: 50%;
            object-fit: cover;
            margin: 0 auto 8px;
            display: block;
            border: 3px solid #7986cb;
        }

        /* Buttons */
        .btn-row { display: flex; gap: 10px; margin-top: 20px; flex-wrap: wrap; }
        .save-btn, .send-btn {
            flex: 1;
            padding: 11px 0;
            background: linear-gradient(135deg, #3949ab, #1a237e);
            color: #fff;
            border: none; border-radius: 8px;
            font-size: .97rem; font-weight: 600;
            cursor: pointer;
            transition: opacity .2s;
        }
        .save-btn:hover, .send-btn:hover { opacity: .88; }
        .cancel-modal-btn {
            flex: 1;
            padding: 11px 0;
            background: #eee;
            color: #555;
            border: none; border-radius: 8px;
            font-size: .97rem; font-weight: 600;
            cursor: pointer;
        }
        .delete-confirm-btn {
            flex: 1;
            padding: 11px 0;
            background: #c62828;
            color: #fff;
            border: none; border-radius: 8px;
            font-size: .97rem; font-weight: 600;
            cursor: pointer;
        }

        /* ===== PROFILE CARD (enhanced) ===== */
        .profile-card {
            display: flex;
            gap: 28px;
            align-items: flex-start;
            background: linear-gradient(135deg, #e8eaf6 0%, #fff 100%);
            border: 1px solid #c5cae9;
            border-radius: 18px;
            padding: 28px;
            box-shadow: 0 4px 20px rgba(57,73,171,.12);
            flex-wrap: wrap;
        }
        .profile-image-wrapper { position: relative; }
        .profile-image {
            width: 140px; height: 140px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid #3949ab;
            box-shadow: 0 4px 16px rgba(57,73,171,.25);
        }
        .profile-info h2 { margin: 0 0 4px; color: #1a237e; }
        .profile-info .title { color: #3949ab; font-weight: 600; margin: 2px 0; }
        .profile-info .department { color: #666; margin: 2px 0 12px; }

        /* Extra profile fields */
        .profile-meta { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 14px; }
        .meta-tag {
            background: #e8eaf6;
            border-radius: 20px;
            padding: 5px 14px;
            font-size: .82rem;
            color: #3949ab;
            font-weight: 600;
        }
        .meta-tag span { font-weight: 400; color: #444; }

        .profile-actions { display: flex; gap: 10px; flex-wrap: wrap; }
        .edit-btn, .delete-btn, .msg-btn {
            padding: 8px 20px;
            border-radius: 8px;
            border: none;
            font-size: .9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all .2s;
        }
        .edit-btn { background: #3949ab; color: #fff; }
        .edit-btn:hover { background: #1a237e; }
        .delete-btn { background: #ffebee; color: #c62828; border: 1px solid #ef9a9a; }
        .delete-btn:hover { background: #c62828; color: #fff; }

        /* ===== DYNAMIC PANEL ===== */
        .dynamic-panel {
            display: none;
            background: #fff;
            border: 1px solid #c5cae9;
            border-radius: 16px;
            padding: 28px;
            margin-top: 20px;
            box-shadow: 0 4px 20px rgba(57,73,171,.08);
            animation: fadeIn .3s ease;
        }
        .dynamic-panel.active { display: block; }
        @keyframes fadeIn { from{opacity:0;transform:translateY(10px)} to{opacity:1;transform:none} }
        .dynamic-panel h2 { color: #1a237e; margin: 0 0 18px; border-bottom: 2px solid #e8eaf6; padding-bottom: 10px; }
        .dynamic-panel input, .dynamic-panel textarea, .dynamic-panel select {
            padding: 9px 12px; border: 1.5px solid #c5cae9; border-radius: 8px;
            font-size: .95rem; outline: none; width: 100%; box-sizing: border-box; margin-bottom: 10px;
        }
        .dynamic-panel input:focus, .dynamic-panel textarea:focus, .dynamic-panel select:focus { border-color: #3949ab; }
        .dynamic-panel button {
            padding: 9px 22px;
            background: #3949ab; color: #fff;
            border: none; border-radius: 8px;
            font-size: .92rem; font-weight: 600; cursor: pointer;
        }
        .dynamic-panel button:hover { background: #1a237e; }

        /* Recipient selector */
        .recipient-row { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 10px; }
        .recipient-chip {
            padding: 6px 16px;
            border-radius: 20px;
            border: 2px solid #c5cae9;
            background: #f5f5ff;
            color: #444;
            cursor: pointer;
            font-size: .88rem;
            font-weight: 600;
            transition: all .2s;
        }
        .recipient-chip.selected { background: #3949ab; color: #fff; border-color: #3949ab; }

        /* Announcement / message list */
        .item-list { list-style: none; padding: 0; margin: 16px 0 0; }
        .item-list li {
            background: #f5f5ff;
            border-radius: 10px;
            padding: 12px 16px;
            margin-bottom: 10px;
            border-left: 4px solid #3949ab;
            font-size: .93rem;
        }
        .item-list li .item-meta { font-size: .78rem; color: #888; margin-top: 4px; }
        .item-list li .recipients-badge {
            display: inline-block;
            background: #e8eaf6;
            border-radius: 12px;
            padding: 2px 10px;
            font-size: .76rem;
            color: #3949ab;
            font-weight: 600;
            margin-top: 6px;
        }

        /* Access buttons */
        .access-btn { cursor: pointer; }

        /* Toast */
        #toast {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            background: #1a237e; color: #fff;
            padding: 12px 28px; border-radius: 30px;
            font-size: .95rem; font-weight: 600;
            box-shadow: 0 4px 20px rgba(0,0,0,.2);
            opacity: 0; pointer-events: none;
            transition: opacity .4s;
            z-index: 99999;
        }
        #toast.show { opacity: 1; }

        /* Announcement highlight */
        .announcement-badge {
            display: inline-block;
            background: #ff6f00;
            color: #fff;
            font-size: .72rem;
            border-radius: 10px;
            padding: 2px 8px;
            margin-left: 8px;
            font-weight: 700;
            vertical-align: middle;
        }

        @media(max-width:600px){
            .profile-card { flex-direction: column; align-items: center; text-align: center; }
            .profile-meta { justify-content: center; }
        }
    </style>
</head>
<body>

<!-- Navigation -->
<nav class="navbar">
    <div class="nav-container">
        <a href="index.html" class="nav-back">‚Üê Back to Home</a>
        <h1 class="nav-title">Director Panel</h1>
        <div></div>
    </div>
</nav>

<!-- Hero Section -->
<header class="hero-section">
    <img class="hero-banner" src="./hero-banner.png" alt="Institute Banner">
</header>
<section class="hero-text">
    <h1>Institute Administration</h1>
    <p>Leadership & Institutional Monitoring</p>
</section>

<!-- ================= EDIT DIRECTOR MODAL ================= -->
<div id="editModal" class="modal">
    <div class="modal-content">
        <button class="modal-close" id="closeEdit">&times;</button>
        <h2><i class="fas fa-user-edit" style="color:#3949ab;margin-right:8px"></i>Edit Director Profile</h2>

        <!-- Photo Upload -->
        <label>Profile Photo</label>
        <div class="photo-upload-area" onclick="document.getElementById('photoInput').click()">
            <img id="photoPreview" src="./principal.jpg" alt="Preview" onerror="this.style.display='none'">
            <i class="fas fa-camera-retro" id="uploadIcon" style="display:none"></i>
            <p id="uploadText">Click to change photo</p>
        </div>
        <input type="file" id="photoInput" accept="image/*" style="display:none">

        <form id="editForm">
            <label>Full Name</label>
            <input type="text" id="editName" value="Dr. Pramod D. Patil" required>

            <label>Title / Designation</label>
            <input type="text" id="editTitle" value="Director" required>

            <label>Department / Institute</label>
            <input type="text" id="editDepartment" value="NMIET Institute" required>

            <label>Qualification</label>
            <input type="text" id="editQualification" placeholder="e.g. Ph.D. in Computer Science">

            <label>Experience</label>
            <input type="text" id="editExperience" placeholder="e.g. 20+ Years in Academia">

            <label>Expertise / Specialization</label>
            <input type="text" id="editExpertise" placeholder="e.g. Machine Learning, IoT, Research">

            <label>Publications</label>
            <input type="text" id="editPublications" placeholder="e.g. 45 Research Papers, 3 Books">

            <div class="btn-row">
                <button type="submit" class="save-btn"><i class="fas fa-save"></i> Save Changes</button>
                <button type="button" class="cancel-modal-btn" id="cancelEdit">Cancel</button>
            </div>
        </form>
    </div>
</div>

<!-- ================= DELETE CONFIRM MODAL ================= -->
<div id="deleteModal" class="modal">
    <div class="modal-content" style="max-width:400px;text-align:center;">
        <button class="modal-close" id="closeDelete">&times;</button>
        <h2 style="color:#c62828"><i class="fas fa-trash-alt" style="margin-right:8px"></i>Confirm Delete</h2>
        <p style="color:#555;margin-bottom:20px">Are you sure you want to delete this Director profile? This action cannot be undone.</p>
        <div class="btn-row">
            <button id="confirmDelete" class="delete-confirm-btn"><i class="fas fa-trash"></i> Yes, Delete</button>
            <button id="cancelDelete" class="cancel-modal-btn">Cancel</button>
        </div>
    </div>
</div>

<!-- ================= SEND MESSAGE MODAL ================= -->
<div id="messageModal" class="modal">
    <div class="modal-content">
        <button class="modal-close" id="closeMessage">&times;</button>
        <h2><i class="fas fa-paper-plane" style="color:#3949ab;margin-right:8px"></i>Send Message</h2>

        <label>Send To</label>
        <div class="recipient-row">
            <div class="recipient-chip selected" data-val="Students">Students</div>
            <div class="recipient-chip" data-val="Parents">Parents</div>
            <div class="recipient-chip" data-val="All">All</div>
        </div>

        <label>Subject</label>
        <input type="text" id="msgSubject" placeholder="Enter message subject">

        <label>Message</label>
        <textarea id="msgBody" placeholder="Write your message here..." style="min-height:120px"></textarea>

        <div class="btn-row">
            <button class="send-btn" id="sendMsgBtn"><i class="fas fa-paper-plane"></i> Send Message</button>
            <button class="cancel-modal-btn" id="cancelMessage">Cancel</button>
        </div>
    </div>
</div>

<!-- Main Content -->
<main class="container">

    <!-- Director Profile -->
    <section class="profile-section">
        <div class="profile-card">
            <div class="profile-image-wrapper">
                <img src="./principal.jpg" alt="Director" class="profile-image" id="directorPhoto" onerror="this.src='https://ui-avatars.com/api/?name=Director&background=3949ab&color=fff&size=140'">
            </div>
            <div class="profile-info">
                <h2 id="displayName">Dr. Pramod D. Patil</h2>
                <p class="title" id="displayTitle">Director</p>
                <p class="department" id="displayDepartment">NMIET Institute</p>

                <div class="profile-meta" id="profileMeta">
                    <div class="meta-tag">üéì Qualification: <span id="displayQualification">‚Äî</span></div>
                    <div class="meta-tag">üíº Experience: <span id="displayExperience">‚Äî</span></div>
                    <div class="meta-tag">üî¨ Expertise: <span id="displayExpertise">‚Äî</span></div>
                    <div class="meta-tag">üìÑ Publications: <span id="displayPublications">‚Äî</span></div>
                </div>

                <div class="profile-actions">
                    <button class="edit-btn" id="openEditBtn"><i class="fas fa-edit"></i> Edit Profile</button>
                    <button class="delete-btn" id="openDeleteBtn"><i class="fas fa-trash-alt"></i> Delete</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Institute Stats -->
    <section class="stats-section">
        <div class="stat-card">
            <div class="stat-icon">üè¢</div>
            <h3>Departments</h3>
            <p class="stat-number">16</p>
        </div>
        <div class="stat-card">
            <div class="stat-icon">üéì</div>
            <h3>Total Students</h3>
            <p class="stat-number">850</p>
        </div>
        <div class="stat-card">
            <div class="stat-icon">üë®‚Äçüè´</div>
            <h3>Faculty Members</h3>
            <p class="stat-number">65</p>
        </div>
        <div class="stat-card">
            <div class="stat-icon">üìä</div>
            <h3>Overall Attendance</h3>
            <p class="stat-number">82%</p>
        </div>
    </section>

    <!-- Quick Access -->
    <section class="quick-access">
        <h2>Quick Access</h2>
        <div class="access-buttons">

            <a href="hod1.html" class="access-btn faculty-btn">
                <span class="btn-icon">üèõ</span>
                <div class="btn-text">
                    <strong>Manage Departments</strong>
                    <p>Add or monitor departments</p>
                </div>
            </a>

            <div class="access-btn settings-btn" onclick="openPanel('settingsPanel')">
                <span class="btn-icon">‚öôÔ∏è</span>
                <div class="btn-text">
                    <strong>Settings</strong>
                    <p>Configure system settings</p>
                </div>
            </div>

            <div class="access-btn reports-btn" onclick="openPanel('studentPanel')">
                <span class="btn-icon">üìö</span>
                <div class="btn-text">
                    <strong>Student Reports</strong>
                    <p>View academic performance</p>
                </div>
            </div>

            <div class="access-btn notice-btn" onclick="openPanel('noticePanel')">
                <span class="btn-icon">üì¢</span>
                <div class="btn-text">
                    <strong>Publish Notice</strong>
                    <p>Send announcements institute-wide</p>
                </div>
            </div>

            <!-- NEW: Send Message -->
            <div class="access-btn" style="background:linear-gradient(135deg,#e3f2fd,#fff);border:1px solid #90caf9" onclick="openMessageModal()">
                <span class="btn-icon">‚úâÔ∏è</span>
                <div class="btn-text">
                    <strong>Send Message</strong>
                    <p>Message students & parents</p>
                </div>
            </div>

            <!-- NEW: Announcements -->
            <div class="access-btn" style="background:linear-gradient(135deg,#fff8e1,#fff);border:1px solid #ffe082" onclick="openPanel('announcementPanel')">
                <span class="btn-icon">üì£</span>
                <div class="btn-text">
                    <strong>Announcements <span class="announcement-badge" id="announceBadge" style="display:none">0</span></strong>
                    <p>Visible to students & parents</p>
                </div>
            </div>

        </div>
    </section>

    <!-- ================= DYNAMIC PANELS ================= -->

    <section id="departmentsPanel" class="dynamic-panel">
        <h2>Manage Departments</h2>
        <input type="text" id="newDept" placeholder="Enter Department Name">
        <button onclick="addDepartment()">Add Department</button>
        <ul id="deptList" class="item-list"></ul>
    </section>

    <section id="settingsPanel" class="dynamic-panel">
        <h2>Settings</h2>
        <label><input type="checkbox" id="darkModeToggle"> Enable Dark Mode</label>
    </section>

    <section id="studentPanel" class="dynamic-panel">
        <h2>Student Reports</h2>
        <p>Total Students: 850</p>
        <p>Average CGPA: 8.2</p>
    </section>

    <section id="noticePanel" class="dynamic-panel">
        <h2>Publish Notice</h2>
        <textarea id="noticeText" placeholder="Write notice here"></textarea>
        <button onclick="publishNotice()" style="margin-top:4px">Publish</button>
        <ul id="noticeList" class="item-list"></ul>
    </section>

    <!-- NEW: Message Sent Log Panel (opens via quick access) -->
    <section id="messageLogPanel" class="dynamic-panel">
        <h2>üì¨ Sent Messages</h2>
        <ul id="messageList" class="item-list">
            <li style="color:#aaa;border-left-color:#ccc">No messages sent yet.</li>
        </ul>
    </section>

    <!-- NEW: Announcements Panel -->
    <section id="announcementPanel" class="dynamic-panel">
        <h2>üì£ Announcements <small style="font-size:.75rem;color:#888;font-weight:400">(Visible to Students & Parents)</small></h2>

        <label style="font-weight:600;color:#555;font-size:.85rem;text-transform:uppercase;letter-spacing:.5px">Visible To</label>
        <div class="recipient-row" id="announceRecipients">
            <div class="recipient-chip selected" data-val="Students">Students</div>
            <div class="recipient-chip" data-val="Parents">Parents</div>
            <div class="recipient-chip" data-val="All">All</div>
        </div>

        <input type="text" id="announceTitle" placeholder="Announcement Title" style="margin-top:8px">
        <textarea id="announceBody" placeholder="Write announcement details..." style="min-height:100px"></textarea>
        <button onclick="publishAnnouncement()"><i class="fas fa-bullhorn"></i> Post Announcement</button>

        <ul id="announceList" class="item-list" style="margin-top:20px"></ul>
    </section>

</main>

<!-- Footer -->
<footer class="footer" id="contact">
    <div class="footer-top">
        ¬© Copyright 2026 |
        <strong>NMIET Institute</strong> |
        All Rights Reserved |
        SEO & Web Design by Sandesh, Khushal & Vaishnavi
    </div>
    <div class="footer-bottom">
        <p>Our Team</p>
        <div class="team-social">
            <div class="member">
                <span>Sandesh Shingankar</span>
                <a href="https://github.com/sandeshshingankar" title="GitHub"><i class="fab fa-github"></i></a>
                <a href="https://www.linkedin.com/in/sandeshs-shingankar/" title="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
            </div>
            <div class="member">
                <span>Khushal Warule</span>
                <a href="https://github.com/KhushalWarule" title="GitHub"><i class="fab fa-github"></i></a>
                <a href="https://www.linkedin.com/in/khushal-warule-781329292" title="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
            </div>
            <div class="member">
                <span>Vaishnavi Kadganchi</span>
                <a href="https://github.com/vaishnavikadganchi" title="GitHub"><i class="fab fa-github"></i></a>
                <a href="www.linkedin.com/in/vaishnavi-kadganchi" title="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
            </div>
            <div class="member">
                <span>Tejas Naiknaware</span>
                <a href="https://github.com/tejasn369" title="GitHub"><i class="fab fa-github"></i></a>
                <a href="https://www.linkedin.com/in/tejas-naiknaware/" title="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
            </div>
        </div>
    </div>
    <button class="scroll-top" onclick="scrollToTop()" aria-label="Scroll to top">‚Üë</button>
</footer>

<!-- Toast -->
<div id="toast"></div>

<script src="scroll-to-top.js"></script>

<script>
// ===== DIRECTOR DATA =====
let directorData = {
    name: 'Dr. Pramod D. Patil',
    title: 'Director',
    department: 'NMIET Institute',
    qualification: '',
    experience: '',
    expertise: '',
    publications: '',
    photoSrc: './principal.jpg'
};

let messages = [];
let announcements = [];

// ===== TOAST =====
function showToast(msg) {
    const t = document.getElementById('toast');
    t.textContent = msg;
    t.classList.add('show');
    setTimeout(() => t.classList.remove('show'), 2800);
}

// ===== MODAL HELPERS =====
function openModal(id) { document.getElementById(id).classList.add('active'); }
function closeModal(id) { document.getElementById(id).classList.remove('active'); }

// ===== EDIT MODAL =====
document.getElementById('openEditBtn').onclick = function() {
    // Populate form from directorData
    document.getElementById('editName').value = directorData.name;
    document.getElementById('editTitle').value = directorData.title;
    document.getElementById('editDepartment').value = directorData.department;
    document.getElementById('editQualification').value = directorData.qualification;
    document.getElementById('editExperience').value = directorData.experience;
    document.getElementById('editExpertise').value = directorData.expertise;
    document.getElementById('editPublications').value = directorData.publications;
    document.getElementById('photoPreview').src = directorData.photoSrc;
    document.getElementById('photoPreview').style.display = 'block';
    openModal('editModal');
};
document.getElementById('closeEdit').onclick = () => closeModal('editModal');
document.getElementById('cancelEdit').onclick = () => closeModal('editModal');

// Photo upload preview
document.getElementById('photoInput').onchange = function(e) {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function(ev) {
        const preview = document.getElementById('photoPreview');
        preview.src = ev.target.result;
        preview.style.display = 'block';
        directorData.photoSrc = ev.target.result;
    };
    reader.readAsDataURL(file);
};

// Edit form submit
document.getElementById('editForm').onsubmit = function(e) {
    e.preventDefault();
    directorData.name        = document.getElementById('editName').value.trim();
    directorData.title       = document.getElementById('editTitle').value.trim();
    directorData.department  = document.getElementById('editDepartment').value.trim();
    directorData.qualification = document.getElementById('editQualification').value.trim();
    directorData.experience  = document.getElementById('editExperience').value.trim();
    directorData.expertise   = document.getElementById('editExpertise').value.trim();
    directorData.publications= document.getElementById('editPublications').value.trim();

    // Update display
    document.getElementById('displayName').textContent       = directorData.name;
    document.getElementById('displayTitle').textContent      = directorData.title;
    document.getElementById('displayDepartment').textContent = directorData.department;
    document.getElementById('displayQualification').textContent = directorData.qualification || '‚Äî';
    document.getElementById('displayExperience').textContent = directorData.experience    || '‚Äî';
    document.getElementById('displayExpertise').textContent  = directorData.expertise     || '‚Äî';
    document.getElementById('displayPublications').textContent = directorData.publications || '‚Äî';
    document.getElementById('directorPhoto').src             = directorData.photoSrc;

    closeModal('editModal');
    showToast('‚úÖ Director profile updated successfully!');
};

// ===== DELETE MODAL =====
document.getElementById('openDeleteBtn').onclick = () => openModal('deleteModal');
document.getElementById('closeDelete').onclick  = () => closeModal('deleteModal');
document.getElementById('cancelDelete').onclick = () => closeModal('deleteModal');
document.getElementById('confirmDelete').onclick = function() {
    document.querySelector('.profile-card').style.opacity = '0.3';
    document.querySelector('.profile-card').style.pointerEvents = 'none';
    closeModal('deleteModal');
    showToast('üóëÔ∏è Director profile deleted.');
};

// ===== SEND MESSAGE MODAL =====
// Recipient chips
let selectedMsgRecipients = ['Students'];
document.querySelectorAll('#messageModal .recipient-chip').forEach(chip => {
    chip.onclick = function() {
        const val = this.dataset.val;
        if (val === 'All') {
            selectedMsgRecipients = ['All'];
            document.querySelectorAll('#messageModal .recipient-chip').forEach(c => c.classList.remove('selected'));
            this.classList.add('selected');
        } else {
            const allChip = document.querySelector('#messageModal .recipient-chip[data-val="All"]');
            allChip.classList.remove('selected');
            selectedMsgRecipients = selectedMsgRecipients.filter(v => v !== 'All');
            this.classList.toggle('selected');
            if (this.classList.contains('selected')) {
                if (!selectedMsgRecipients.includes(val)) selectedMsgRecipients.push(val);
            } else {
                selectedMsgRecipients = selectedMsgRecipients.filter(v => v !== val);
            }
            if (selectedMsgRecipients.length === 0) {
                selectedMsgRecipients = ['Students'];
                document.querySelector('#messageModal .recipient-chip[data-val="Students"]').classList.add('selected');
            }
        }
    };
});

function openMessageModal() {
    document.getElementById('msgSubject').value = '';
    document.getElementById('msgBody').value = '';
    openModal('messageModal');
}
document.getElementById('closeMessage').onclick  = () => closeModal('messageModal');
document.getElementById('cancelMessage').onclick = () => closeModal('messageModal');

document.getElementById('sendMsgBtn').onclick = function() {
    const subject = document.getElementById('msgSubject').value.trim();
    const body    = document.getElementById('msgBody').value.trim();
    if (!subject || !body) { showToast('‚ö†Ô∏è Please fill in subject and message.'); return; }

    const msg = { subject, body, to: [...selectedMsgRecipients], time: new Date().toLocaleString() };
    messages.push(msg);

    // Update message log panel
    const list = document.getElementById('messageList');
    if (list.querySelector('li[style]')) list.innerHTML = '';
    const li = document.createElement('li');
    li.innerHTML = `<strong>${msg.subject}</strong><br>${msg.body}
        <div class="item-meta">Sent: ${msg.time}</div>
        <span class="recipients-badge">To: ${msg.to.join(', ')}</span>`;
    list.prepend(li);

    closeModal('messageModal');
    showToast(`‚úâÔ∏è Message sent to ${msg.to.join(' & ')}!`);
};

// ===== ANNOUNCEMENTS PANEL =====
let selectedAnnounceRecipients = ['Students'];
document.querySelectorAll('#announceRecipients .recipient-chip').forEach(chip => {
    chip.onclick = function() {
        const val = this.dataset.val;
        if (val === 'All') {
            selectedAnnounceRecipients = ['All'];
            document.querySelectorAll('#announceRecipients .recipient-chip').forEach(c => c.classList.remove('selected'));
            this.classList.add('selected');
        } else {
            const allChip = document.querySelector('#announceRecipients .recipient-chip[data-val="All"]');
            allChip.classList.remove('selected');
            selectedAnnounceRecipients = selectedAnnounceRecipients.filter(v => v !== 'All');
            this.classList.toggle('selected');
            if (this.classList.contains('selected')) {
                if (!selectedAnnounceRecipients.includes(val)) selectedAnnounceRecipients.push(val);
            } else {
                selectedAnnounceRecipients = selectedAnnounceRecipients.filter(v => v !== val);
            }
            if (selectedAnnounceRecipients.length === 0) {
                selectedAnnounceRecipients = ['Students'];
                document.querySelector('#announceRecipients .recipient-chip[data-val="Students"]').classList.add('selected');
            }
        }
    };
});

function publishAnnouncement() {
    const title = document.getElementById('announceTitle').value.trim();
    const body  = document.getElementById('announceBody').value.trim();
    if (!title || !body) { showToast('‚ö†Ô∏è Please enter title and announcement text.'); return; }

    const ann = { title, body, to: [...selectedAnnounceRecipients], time: new Date().toLocaleString() };
    announcements.push(ann);

    const list = document.getElementById('announceList');
    const li = document.createElement('li');
    li.innerHTML = `<strong>üì£ ${ann.title}</strong><br>${ann.body}
        <div class="item-meta">Posted: ${ann.time}</div>
        <span class="recipients-badge">Visible to: ${ann.to.join(', ')}</span>`;
    list.prepend(li);

    // Update badge
    const badge = document.getElementById('announceBadge');
    badge.style.display = 'inline-block';
    badge.textContent = announcements.length;

    document.getElementById('announceTitle').value = '';
    document.getElementById('announceBody').value = '';
    showToast(`üì£ Announcement posted to ${ann.to.join(' & ')}!`);

    // Store in sessionStorage so student/parent pages can read it
    sessionStorage.setItem('nmiet_announcements', JSON.stringify(announcements));
}

// ===== PANELS =====
function openPanel(id) {
    const panels = document.querySelectorAll('.dynamic-panel');
    panels.forEach(p => {
        if (p.id === id) {
            const isOpen = p.classList.contains('active');
            p.classList.toggle('active', !isOpen);
            if (!isOpen) p.scrollIntoView({ behavior: 'smooth', block: 'start' });
        } else {
            p.classList.remove('active');
        }
    });
}

function addDepartment() {
    const val = document.getElementById('newDept').value.trim();
    if (!val) return;
    const li = document.createElement('li');
    li.textContent = val;
    document.getElementById('deptList').prepend(li);
    document.getElementById('newDept').value = '';
    showToast('üèõ Department added!');
}

function publishNotice() {
    const text = document.getElementById('noticeText').value.trim();
    if (!text) return;
    const li = document.createElement('li');
    const time = new Date().toLocaleString();
    li.innerHTML = `${text}<div class="item-meta">${time}</div>`;
    document.getElementById('noticeList').prepend(li);
    document.getElementById('noticeText').value = '';
    showToast('üì¢ Notice published!');
}

// Close modals on backdrop click
['editModal','deleteModal','messageModal'].forEach(id => {
    document.getElementById(id).addEventListener('click', function(e) {
        if (e.target === this) closeModal(id);
    });
});
</script>
</body>
</html>
